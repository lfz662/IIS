var MapCluster=function(){"use strict";function t(t,e){return"string"==typeof t?(e||document).querySelector(t):t||null}function e(t,e){const i=document.createElement(t);for(let t in e)if("append_to"===t){e.append_to.appendChild(i)}else if("innerHTML"===t)i.innerHTML=void 0!=e.innerHTML?e.innerHTML:"";else if("css"===t)for(let n in e[t])i.style[n]=e[t][n];else i.setAttribute(t,e[t]);return i}t.on=((e,i,n=null,s)=>{s?t.delegate(e,i,n,s):(s=n,t.bind(e,i,s))}),t.off=((t,e,i)=>{t.removeEventListener(e,i)}),t.bind=((t,e,i)=>{e.split(/\s+/).forEach(function(e){t.addEventListener(e,i)})}),t.delegate=((t,e,i,n)=>{t.addEventListener(e,function(t){const e=t.target.closest(i);e&&(t.delegatedTarget=e,n.call(this,t,e))})}),t.parents=((t,e)=>{if(t.classList.contains(e))return t;for(;(t=t.parentElement)&&!t.classList.contains(e););return t}),t.index=(t=>{if(t){let e=t.parentNode.childNodes,i=0;for(let n=0;n<e.length;n++){if(e[n]==t)return i;1==e[n].nodeType&&i++}}return-1}),t.ajax=((t=!1,e)=>{t=t||{data:{},type:"GET",url:""};let i=new XMLHttpRequest;i.open(t.type,t.url,!0),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(t.data)),i.onload=function(){try{return this.response?e(JSON.parse(this.response)):e(this.response),!1}catch(t){}e(this.response)}});var i=Object.prototype.hasOwnProperty,n=Object.prototype.toString,s=Object.defineProperty,o=Object.getOwnPropertyDescriptor,a=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===n.call(t)},r=function(t){if(!t||"[object Object]"!==n.call(t))return!1;var e,s=i.call(t,"constructor"),o=t.constructor&&t.constructor.prototype&&i.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!s&&!o)return!1;for(e in t);return void 0===e||i.call(t,e)},l=function(t,e){s&&"__proto__"===e.name?s(t,e.name,{enumerable:!0,configurable:!0,value:e.newValue,writable:!0}):t[e.name]=e.newValue},c=function(t,e){if("__proto__"===e){if(!i.call(t,e))return;if(o)return o(t,e).value}return t[e]};function h(){var t,e,i,n,s,o,p=arguments[0],d=1,u=arguments.length,v=!1;for("boolean"==typeof p&&(v=p,p=arguments[1]||{},d=2),(null==p||"object"!=typeof p&&"function"!=typeof p)&&(p={});d<u;++d)if(null!=(t=arguments[d]))for(e in t)i=c(p,e),p!==(n=c(t,e))&&(v&&n&&(r(n)||(s=a(n)))?(s?(s=!1,o=i&&a(i)?i:[]):o=i&&r(i)?i:{},l(p,{name:e,newValue:h(v,o,n)})):void 0!==n&&l(p,{name:e,newValue:n}));return p}const p="undefined"!=typeof window?window:global;let d=p.requestAnimationFrame,u=p.cancelAnimationFrame;if(!d||!u){let t=0;d=function(e,i){const n=(new Date).getTime(),s=Math.max(0,16-(n-t)),o=p.setTimeout(function(){e(n+s)},s);return t=n+s,o},u=function(t){clearTimeout(t)}}var v=t=>{let e;return(i,n,s,o)=>{e&&u(e.id),e=new class{constructor(t,e,i,n,s){let o=0,a=0;this.getCurrentState=(()=>{const n={};return Object.keys(t).forEach(s=>{n[s]=t[s]+a/i*(e[s]-t[s])}),n}),this.animate=(t=>{o||(o=t),(a=t-o)<=i?(n(this.getCurrentState()),this.id=d(this.animate)):s()}),this.id=d(this.animate.bind(this))}}(i,n,s,t||Function.prototype,(...t)=>{e=null,(o||Function.prototype).apply(null,t)})}};const g={initialViewBox:null,animationTime:200,limits:"0",eventMagnet:null,zoom:{factor:.25,minZoom:1,maxZoom:2,events:{mouseWheel:!1,doubleClick:!0,pinch:!0},callback:function(t){}},pan:{factor:100,events:{drag:!0,dragMouseButton:1,dragCursor:"move"},callback:function(t){}}},m={x:0,y:0,width:1e3,height:1e3},y=t=>{const e=t.replace(/\s+/g," ").split(" ");return{x:parseFloat(e[0]),y:parseFloat(e[1]),width:parseFloat(e[2]),height:parseFloat(e[3])}},f=function(t,e){const i=t.createSVGPoint();return i.x=parseInt(e.x,10),i.y=parseInt(e.y,10),i.matrixTransform(t.getScreenCTM().inverse())},w=function(t,e){e=e.originalEvent||e,/touch/i.test(e.type)&&(null!==e.touches&&e.touches.length?e=e.touches[0]:null!==e.changedTouches&&e.changedTouches.length&&(e=e.changedTouches[0]));const i={x:e.clientX,y:e.clientY};return f(t,i)},b=function(t,e){t.setAttribute("viewBox",[e.x,e.y,e.width,e.height].join(" "))},x=function(t){const e=(t.originalEvent||t).touches;return Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2))},E=function(t){return 2===(t.originalEvent||t).touches.length},M=function(t,e){const i=(e.originalEvent||e).touches;return f(t,{x:(i[0].clientX+i[1].clientX)/2,y:(i[0].clientY+i[1].clientY)/2})};class L{constructor(t,e){if(!(t instanceof SVGElement))throw new Error("Invalid Parameters. Firt parameter to SVGPanZoom should be an svg element");this.svg=t,t.setAttribute("preserveAspectRatio","xMidYMid meet");let i=h({},t.viewBox.baseVal);0===i.x&&0===i.y&&0===i.width&&0===i.height&&(i=m);{let t;Object.defineProperty(this,"options",{get:function(){return t},set:function(e){if(t)throw new Error("Options cannot be overriden");t=e}})}{const e=this;let n,s,o,a;this.options={get initialViewBox(){return n},set initialViewBox(t){if(null!==t)if("string"==typeof t)i=y(t);else{if("object"!=typeof t)throw new Error("initialViewBox is of invalid type");i=h({},m,t)}n=h({},i)},get animationTime(){return s},set animationTime(t){s=t||0},get eventMagnet(){return o},set eventMagnet(i){e.destroy(),o=i||t,e._setupEvents()},get limits(){return a},set limits(t){a={};const e=((t||(0===t?0:15))+"").trim().split(" ");{const t=Number((e[1]||e[0]).replace(/%/g,""))/100,n=i.height*t;a.minX=i.x-n,a.maxX=i.x+n}{const t=Number(e[0].replace(/%/g,""))/100,n=i.width*t;a.minY=i.y-n,a.maxY=i.y+n}}}}const n=v(e=>b(t,e));this.getViewBox=(()=>h({},i)),this.setViewBox=((e,s,o,a,r,l)=>{"function"==typeof r&&(l=r,r=null),r||0===r||(r=this.options.animationTime);const c=this.getViewBox();return i={x:e||0===e?e:i.x,y:s||0===s?s:i.y,width:o||0===o?o:i.width,height:a||0===a?a:i.height},this.validateLimits(i),r>0?n(c,i,r,l):(b(t,i),(l||Function.prototype)()),this});{function s(t,e,i){return this.options.pan&&(e||0===e||(e=this.options.pan.factor))?t(e,i):this}this.panLeft=s.bind(this,(t,e)=>this.pan(i.x-t,null,e)),this.panRight=s.bind(this,(t,e)=>this.pan(i.x+t,null,e)),this.panUp=s.bind(this,(t,e)=>this.pan(null,i.y-t,e)),this.panDown=s.bind(this,(t,e)=>this.pan(null,i.y+t,e)),this.pan=((t,e,i)=>this.setViewBox(t,e,null,null,i,()=>{this.options.pan.callback(this.getViewBox())}))}{function o(t,e,i,n,s=!1){return this.options.zoom&&(i||0===i||(i=this.options.zoom.factor))?t(e,i,n,s):this}this.zoomIn=o.bind(this,(t,e,i,n)=>this.zoomOut(t,-e,i,n)),this.zoomOut=o.bind(this,(e,n,s,o)=>{let a,r;n<0?(r=i.width/(1-n),a=i.height/(1-n)):(r=i.width*(1+n),a=i.height*(1+n));const l=this.options.initialViewBox.width/this.options.zoom.maxZoom,c=this.options.initialViewBox.width/this.options.zoom.minZoom;r<l?(a*=l/r,r=l):r>c&&(a*=c/r,r=c);const h=this.options.initialViewBox.height/this.options.zoom.maxZoom,p=this.options.initialViewBox.height/this.options.zoom.minZoom;let d;if(a<h?(r*=h/a,a=h):a>p&&(r*=p/a,a=p),o){f(t,e);d={x:e.x-r/2,y:e.y-a/2}}else d=e?{x:e.x+r/i.width*(i.x-e.x),y:e.y+a/i.height*(i.y-e.y)}:{x:i.x+(i.width-r)/2,y:i.y+(i.height-a)/2};return this.setViewBox(d.x,d.y,r,a,s,()=>{this.options.zoom.callback(this.options.initialViewBox.width/r,this.getViewBox())})})}this.destroy=Function.prototype,h(this.options,h(!0,{},g,e)),this.reset(0)}validateLimits(t){const e=this.options.limits,i=this.options.initialViewBox;t.width<=i.width?t.x=Math.min(Math.max(t.x,e.minX),e.maxX+(i.width-t.width)):t.x=Math.min(Math.max(t.x,e.minX+(i.width-t.width)),e.maxX),t.height<=i.height?t.y=Math.min(Math.max(t.y,e.minY),e.maxY+(i.height-t.height)):t.y=Math.min(Math.max(t.y,e.minY+(i.height-t.height)),e.maxY)}reset(t,e){return this.clone(this.options.initialViewBox,t,e)}clone(t,e,i){return this.setViewBox(t.x,t.y,t.width,t.height,e,i)}getCenter(){const t=this.getViewBox();return{x:t.x+t.width/2,y:t.y+t.height/2}}setCenter(t,e,i,n){const s=this.getViewBox();return this.setViewBox(t-s.width/2,e-s.height/2,s.width,s.height,i,n)}_setupEvents(){const t=this.svg,e={mousewheel:function(e){e.preventDefault(),e.stopPropagation();const i=(e=e||e.originalEvent).detail||e.deltaX||e.deltaY||e.deltaZ,n=parseInt(-i||e.wheelDelta);if(!n||!this.options.zoom||!this.options.zoom.events.mouseWheel)return;const s=w(t,e);n>0?this.zoomIn(s,null,0):this.zoomOut(s,null,0)},dblclick:function(e){this.options.zoom&&this.options.zoom.events.doubleClick&&this.zoomIn(w(t,e))}};{let i=!1,n=!1,s=!1,o=0;e.click=function(t){s&&(s=!1,t.preventDefault())},e.pinchAndDrag=function(e){if(!this.options.pan.events.drag||"mousedown"===e.type&&e.which!==this.options.pan.events.dragMouseButton||i||n)return;s=!1;const a=window.document.body,r=h({},this.getViewBox()),l=this.options.eventMagnet.style.cursor;null!==this.options.pan.events.dragCursor&&(this.options.eventMagnet.style.cursor=this.options.pan.events.dragCursor),"touchstart"===e.type&&E(e)?(n=!0,o=x(e)):i=!0,this.options.pan.events.dragStarted=!1;const c=a=>{this.options.pan.events.dragStarted=!0;const l=/touch/i.test(e.type)&&E(a);if(!n||l)if(a.preventDefault(),!n&&l&&(n=!0,i=!1,o=x(a)),Math.sqrt(Math.pow(e.pageX-a.pageX,2)+Math.pow(e.pageY-a.pageY,2))>25&&(s=!0),i){const i=w(t,e),n=w(t,a);this.pan(r.x+(i.x-n.x),r.y+(i.y-n.y),0)}else if(n){const e=x(a);if(e===o)return;const i=M(t,a);o>e?this.zoomOut(i,(o-e)/e,0):this.zoomOut(i,(o-e)/o,0),o=e}},p=t=>{"mouseout"===t.type&&t.target!==t.currentTarget||"mouseup"===t.type&&t.which!==this.options.pan.events.dragMouseButton||(a.removeEventListener("mousemove",c,{passive:!1,capture:!0}),a.removeEventListener("touchmove",c,{passive:!1,capture:!0}),a.removeEventListener("mouseup",p,{passive:!1,capture:!0}),a.removeEventListener("touchend",p,{passive:!1,capture:!0}),a.removeEventListener("touchcancel",p,{passive:!1,capture:!0}),a.removeEventListener("mouseout",p,{passive:!1,capture:!0}),null!==this.options.pan.events.dragCursor&&(this.options.eventMagnet.style.cursor=l),i=!1,n=!1,o=0)};a.addEventListener("mousemove",c,{passive:!1,capture:!0}),a.addEventListener("touchmove",c,{passive:!1,capture:!0}),a.addEventListener("mouseup",p,{passive:!1,capture:!0}),a.addEventListener("touchend",p,{passive:!1,capture:!0}),a.addEventListener("touchcancel",p,{passive:!1,capture:!0}),a.addEventListener("mouseout",p,{passive:!1,capture:!0})}}Object.keys(e).forEach(t=>{e[t]=e[t].bind(this)}),this.options.eventMagnet.addEventListener("DOMMouseScroll",e.mousewheel),this.options.eventMagnet.addEventListener("wheel",e.mousewheel),this.options.eventMagnet.addEventListener("dblclick",e.dblclick),this.options.eventMagnet.addEventListener("click",e.click,{capture:!0}),this.options.eventMagnet.addEventListener("mousedown",e.pinchAndDrag,{passive:!1,capture:!0}),this.options.eventMagnet.addEventListener("touchstart",e.pinchAndDrag,{passive:!1,capture:!0}),this.destroy=function(){this.options.eventMagnet.removeEventListener("DOMMouseScroll",e.mousewheel),this.options.eventMagnet.removeEventListener("wheel",e.mousewheel),this.options.eventMagnet.removeEventListener("dblclick",e.dblclick),this.options.eventMagnet.removeEventListener("click",e.click,{capture:!0}),this.options.eventMagnet.removeEventListener("mousedown",e.pinchAndDrag,{passive:!1,capture:!0}),this.options.eventMagnet.removeEventListener("touchstart",e.pinchAndDrag,{passive:!1,capture:!0})}}}function T(t,e){return"string"==typeof t?(e||document).querySelector(t):t||null}T.open=(i=>new class{constructor(i){i.container.querySelector(".map-popover")&&i.container.querySelector(".map-popover").parentNode.removeChild(i.container.querySelector(".map-popover"));let n={};n.modal=e("div",{class:"map-popover",append_to:i.container});let s=e("div",{class:"popover-container"+(i.class?" "+i.class:""),append_to:n.modal}),o=e("div",{class:"heading",innerHTML:'<span class="close">x</span><h4 class="title">'+(i.title?i.title:"&nbsp;")+"</h4>",append_to:s});t.on(o,"click",".close",()=>{this.close(n)});e("div",{class:"body",innerHTML:"<table><tbody>"+Object.keys(i.data).map(t=>"<tr><td>"+t+" : "+i.data[t]+"</td></tr>").join("")+"</tbody></table>",append_to:s});return n.modal}close(t){t.modal.parentNode.removeChild(t.modal)}}(i));const C={svg:"",data:"",selectedCategory:"",headerTitle:"Title",tabs:{},elementClasses:{}};return class{constructor(t,e){"string"==typeof t&&(this.wrapper=document.querySelector(t)),this.options=h({},C,e),console.log(this.options),this.init()}init(){this.options.data||this.options.map?"string"==typeof this.options.data&&t.ajax({url:this.options.data,type:"GET"},t=>{this.options.data=t,this.render()}):this.wrapper.innerHTML="Please add Map And Data file!"}render(){this.wrapper.classList.add("map-cluster");let i=e("div",{class:"cluster-header",append_to:this.wrapper});e("div",{class:"header-title",innerHTML:this.options.headerTitle,append_to:i});let n=e("div",{class:"tabs",append_to:e("div",{class:"tab-container",append_to:i})});Object.keys(this.options.tabs).forEach((t,i)=>{let s=e("div",{class:"tab-nav","data-key":t,innerHTML:"<span>"+this.options.tabs[t]+"</span>",append_to:n});i||s.classList.add("selected")}),t.on(n,"click",".tab-nav",t=>(n.querySelector(".tab-nav.selected").classList.remove("selected"),t.delegatedTarget.classList.add("selected"),this.options.selectedCategory=t.delegatedTarget.getAttribute("data-key"),this.svgEvents.reset(),this.renderSvg(),!1)),t.ajax({url:this.options.svg,type:"GET"},i=>{this.svgContainer=e("div",{class:"svg-container",innerHTML:i,append_to:this.wrapper}),this.svg=this.svgContainer.querySelector("svg"),this.bindSvgEvents();let n=e("div",{class:"zoom-controls-container",innerHTML:'<button class="zoomin-btn" data-zoom="zoomIn">+</button><button class="zoomout-btn" data-zoom="zoomOut">-</button><button class="reset-btn" data-zoom="reset"></button>',append_to:this.svgContainer});t.on(n,"click","button",t=>{let e=t.delegatedTarget.getAttribute("data-zoom");"zoomIn"==e||"zoomOut"==e?this.svgEvents[e]():this.svgEvents.reset(),t.delegatedTarget.disabled=!0,setTimeout(()=>{t.delegatedTarget.disabled=!1},500)}),this.renderSvg()})}renderSvg(){this.popover&&(this.popover.parentNode.removeChild(this.popover),this.popover=null),Object.keys(this.options.tabs).forEach(t=>{t&&this.svg.querySelector("#"+t)&&this.svg.querySelector("#"+t).classList.add("hide")}),""!=this.options.selectedCategory&&this.svg.querySelector("#"+this.options.selectedCategory)&&this.svg.querySelector("#"+this.options.selectedCategory).classList.remove("hide");let t=this.svg.querySelectorAll("path.cp");if(t.length&&t.forEach(t=>{t.classList.remove("cp"),t.removeAttribute("data-tab"),t.removeAttribute("data-color")}),(t=this.svg.querySelectorAll("path.map_active")).length&&t.forEach(t=>{t.classList.remove("map_active")}),(t=this.options.data.map(t=>""==this.options.selectedCategory||t.category.indexOf(this.options.tabs[this.options.selectedCategory])>-1?t.cluster:null).filter(t=>t)).length){let e=[];t.forEach(t=>{if(this.svg.querySelector("#"+t)){if(this.svg.querySelector("#"+t).classList.add("cp"),this.svg.querySelector("#"+t).setAttribute("data-tab",this.options.selectedCategory),this.options.elementClasses)for(var i in this.options.elementClasses)this.options.elementClasses[i].indexOf(t)>-1&&this.svg.querySelector("#"+t).setAttribute("data-color",i)}else e.push(t)}),e.length&&console.log("Not Found Ids in svg : "+e.join(", "))}}bindSvgEvents(){this.svgEvents=new L(this.svg,{eventMagnet:this.svgContainer}),t.on(this.svg,"mouseover","path",t=>{this.isActiveCluster(t.delegatedTarget.id)&&t.delegatedTarget.classList.add("map_hover")}),t.on(this.svg,"mouseout","path",(t,e)=>{this.isActiveCluster(t.delegatedTarget.id)&&t.delegatedTarget.classList.remove("map_hover")}),t.on(this.svg,"click","path",t=>{var e=this.isActiveCluster(t.delegatedTarget.id);if(e&&!this.svgEvents.options.pan.events.dragStarted){let i=t.delegatedTarget.getBBox();this.svgEvents.zoomIn({x:i.x,y:i.y},2,800,!0),this.svg.querySelector("path.map_active")&&this.svg.querySelector("path.map_active").classList.remove("map_active"),t.delegatedTarget.classList.add("map_active"),this.popover=T.open({container:this.wrapper,title:"Details",data:{Industry:e.name,Area:"phase1"==this.options.selectedCategory?e.area[1]:e.area[0],Ownership:e.occupied}})}})}isActiveCluster(t){return this.options.data.find(e=>e.cluster==t&&(""==this.options.selectedCategory||e.category.indexOf(this.options.tabs[this.options.selectedCategory])>-1))}}}();
